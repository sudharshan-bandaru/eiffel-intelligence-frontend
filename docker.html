<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 at 2019-10-23 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191023" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Eiffel Intelligence Frontend &#x2013; Docker</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.5.min.js"></script>

          
                      </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                                                                                    <a class="brand" href="./" >

                                
                                    Eiffel Intelligence Frontend
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Overview <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Home">Home</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="running-eiffel-intelligence-frontend.html"  title="Running Eiffel Intelligence front-end">Running Eiffel Intelligence front-end</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="configuration.html"  title="Configuration">Configuration</a>
</li>
                                  <li>      <a href="docker.html"  title="Run in Docker">Run in Docker</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="GUI-overview.html"  title="GUI overview">GUI overview</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="subscription-handling.html"  title="Subscription handling">Subscription handling</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="add-subscription.html"  title="Add Subscription">Add Subscription</a>
</li>
                              </ul>
            </li>
                  
                      <li>      <a href="test-rules.html"  title="Test rules">Test rules</a>
</li>
                  
                      <li>      <a href="curl-examples.html"  title="Curl Examples">Curl Examples</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Eiffel Intelligence Frontend</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                              <li class="">
                    <a href="index.html" title="Home">
        Home</a>
                    <span class="divider">-</span>
      </li>
        <li class="active ">Docker</li>
        
              
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-10-23</li>
              <li id="projectVersion" class="pull-right">
                    Version: 2.0.0
        </li>
            
                            </ul>
      </div>

                  
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
              
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="index.html" title="Home">
          <span class="none"></span>
        Home</a>
            </li>
                                                                                              
      <li>
  
                          <a href="running-eiffel-intelligence-frontend.html" title="Running Eiffel Intelligence front-end">
          <span class="icon-chevron-down"></span>
        Running Eiffel Intelligence front-end</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="configuration.html" title="Configuration">
          <span class="none"></span>
        Configuration</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Run in Docker</a>
          </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="GUI-overview.html" title="GUI overview">
          <span class="none"></span>
        GUI overview</a>
            </li>
                                                                  
      <li>
  
                          <a href="subscription-handling.html" title="Subscription handling">
          <span class="icon-chevron-right"></span>
        Subscription handling</a>
                  </li>
                
      <li>
  
                          <a href="test-rules.html" title="Test rules">
          <span class="none"></span>
        Test rules</a>
            </li>
                
      <li>
  
                          <a href="curl-examples.html" title="Curl Examples">
          <span class="none"></span>
        Curl Examples</a>
            </li>
            </ul>
              
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                        
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Docker</h1>
<p>In Eiffel-Intelligence front-end source code repository, a Dockerfile is provided which helps the developer or user to build the local Eiffel-Intellegence front-end source code repository changes to a Docker image. With the Docker image user can try-out the Eiffel-Intelligence front-end on a Docker Host or in a Kubernetes cluster.</p>
<div class="section">
<h2><a name="Requirements"></a>Requirements</h2>
<ul>

<li>Docker</li>
</ul>
<p>Linux: <a class="externalLink" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p>
<p>Windows: <a class="externalLink" href="https://docs.docker.com/docker-for-windows/install/">https://docs.docker.com/docker-for-windows/install/</a></p>
<ul>

<li>Docker Compose</li>
</ul>
<p>Linux and Windows:  <a class="externalLink" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p></div>
<div class="section">
<h2><a name="Follow_these_step_to_build_the_Docker_image."></a>Follow these step to build the Docker image.</h2>
<p><b>1</b>  Build the Eiffel-Intelligence front-end war file:</p>

<div>
<div>
<pre class="source">mvn package -DskipTests
</pre></div></div>

<p>This will produce a war file in the &#x201c;target&#x201d; folder.</p>
<p><b>2</b> Build the Docker image with the war file that was produced from previous step:</p>

<div>
<div>
<pre class="source">docker build -t eiffel-intelligence-frontend:0.0.19 --build-arg URL=./target/eiffel-intelligence-frontend-0.0.19.war -f src/main/docker/Dockerfile .
</pre></div></div>

<p>Now docker image has build with tag &#x201c;eiffel-intelligence-frontend:0.0.19&#x201d;</p></div>
<div class="section">
<h2><a name="Run_Docker_image_on_local_Docker_Host"></a>Run Docker image on local Docker Host</h2>
<p>To run the produced docker image on the local Docker host, execute this command:</p>

<div>
<div>
<pre class="source">docker run -p 8071:8080 --expose 8080 -e server.port=8080 -e logging.level.log.level.root=DEBUG -e logging.level.org.springframework.web=DEBUG -e logging.level.com.ericsson.ei=DEBUG eiffel-intelligence-frontend:0.0.19
</pre></div></div>

<h1>Some info of all flags to this command</h1></div>
<div class="section">
<h2><a name="Eiffel_Intelligence_Spring_Properties"></a>Eiffel Intelligence Spring Properties</h2>
<p>&#x201c;-e server.port=8080&#x201d; - Is the Spring property setting for Eiffel-Intelligence applications web port.</p>
<p>&#x201c;-e logging.level.root=DEBUG -e logging.level.org.springframework.web=DEBUG -e logging.level.com.ericsson.ei=DEBUG&#x201d; - These Spring properties set the logging level for the Eiffel-Intelligence applications.</p>
<p>It is possible to set all Spring available properties via docker environment &#x201c;-e&#x201d; flag. See the application.properties file for all available Eiffel-Intelligence Spring properties.</p>
<p><a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence/blob/master/src/main/resources/application.properties">application.properties</a></p></div>
<div class="section">
<h2><a name="Docker_flags"></a>Docker flags</h2>
<p>&#x201c;&#x2013;expose 8080&#x201d; - this Docker flag tells that containers internal port shall be exposed to outside of the Docker Host. This flag do not set which port that should be allocated outside Docker Host on the actual server/machine.</p>
<p>&#x201c;-p 8071:8080&#x201d; - this Docker flag is mapping the containers external port 8071 to the internal exposed port 8080. Port 8071 will be allocated outside Docker host and user will be able to access the containers service via port 8071.</p>
<p>When Eiffel-Intelligence container is running on your local Docker host Eiffel-Intelligence should be reachable with address &#x201c;localhost:8071/&lt;Rest End-Point&gt;&#x201d; or &#x201c;&lt;docker host ip&gt;:8071/&lt;Rest End-Point&gt;&#x201d;</p>
<p>In web-browser use url with docker host ip number: &#x201c;&lt;docker host ip&gt;:8071/&#x201d;</p>
<p>Switch-back-end functionality do not work when &#x201c;localhost&#x201d; address is used.</p>
<p>Another option to configure Eiffel Intelligence front-end is to provide the application properties file into the container, which can be made in two ways:</p>
<p><b>1</b> Put application.properties file in Tomcat Catalina config folder in container and run Eiffel Intelligence front-end:</p>

<div>
<div>
<pre class="source">docker run -p 8070:8080 --expose 8080 --volume /path/to/application.properties:/usr/local/tomcat/config/application.properties eiffel-intelligence-frontend:0.0.19
</pre></div></div>

<p><b>2</b> Put application.properties file in a different folder in container and tell EI where the application.properties is located in the container:</p>

<div>
<div>
<pre class="source">docker run -p 8070:8080 --expose 8080 --volume /path/to/application.properties:/tmp/application.properties -e spring.config.location=/tmp/application.properties eiffel-intelligence-frontend:0.0.19
</pre></div></div>

<h1>Run Docker image with provided docker-compose file</h1>
<p>This docker-compose file includes these components, <a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence-frontend/blob/master/src/main/docker/docker-compose.yml">docker-compose.yml</a>:</p>
<ul>

<li>MongoDB</li>
<li>RabbitMq</li>
<li>ER (Event Repository)</li>
<li>Mail server</li>
<li>Jenkins</li>
<li>Eiffel REMReM services (Generate and Publish)</li>
<li>3 instances of EI backend (using different rule sets)</li>
<li>EI frontend (Using the local EI front-end Docker image build from previous steps)</li>
</ul>
<p>NOTE: Only MongoDB, RabbitMQ, ER and EI components are needed to start. The rest of the components can be commented out if not needed.</p>
<div class="section">
<h3><a name="a1_Source_environment_variables_used_in_docker-compose.yml"></a>1 Source environment variables used in docker-compose.yml</h3>
<p>For easier configuration, the Docker images to be used and ports for the different services are set in <a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence-frontend/blob/master/src/main/docker/env.bash">env.bash</a> file. Update to whichever ports you want to use, or keep default values. If you have used a different image tag when you built the EI front-end docker image, then you need to update the <a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence-frontend/blob/master/src/main/docker/env.bash">env.bash file</a> with the locally built image.</p>
<p>To run docker-compose commands, the environment variables needs to be set:</p>

<div>
<div>
<pre class="source">source src/main/docker/env.bash
</pre></div></div>

<p>Two variables need to be set before we can start up all services with docker-compose tool. Set Docker host IP to the HOST variable. This is done automatically when sourcing <a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence-frontend/blob/master/src/main/docker/env.bash">env.bash</a>. But it is also possible to do it manually. If on Linux:</p>

<div>
<div>
<pre class="source">export HOST=$(hostname -I | tr &quot; &quot; &quot;\n&quot;| head -1)
</pre></div></div>

<p>If on Windows, get Docker Host IP with command:</p>

<div>
<div>
<pre class="source">dockermachine ip
</pre></div></div>

<p>Set that Docker host IP to HOST environment variable.</p>
<p>Currently we need to provide EI back-end instances list outside of docker-compose.yml file. This is also done via the <a class="externalLink" href="https://github.com/Ericsson/eiffel-intelligence-frontend/blob/master/src/main/docker/env.bash">env.bash</a> file.</p></div>
<div class="section">
<h3><a name="a2_Then_run_following_docker-compose_command_to_startup_all_components:"></a>2 Then run following docker-compose command to startup all components:</h3>

<div>
<div>
<pre class="source">docker-compose -f src/main/docker/docker-compose.yml up -d
</pre></div></div>

<p>It will take some minutes until all components has started. When all components has loaded, you should be able to access EI front-end web page with address: http://&lt;docker host ip&gt;:8081/</p>
<p>Curl command can be used to make request via EI front-end bridge to EI back-end REST API, example for getting all subscriptions:</p>

<div>
<div>
<pre class="source">curl -X GET http://localhost:8081/subscriptions
</pre></div></div>

<p>It is also possible to access these Rest-Api addresses in web-browser and get result presented in a Json view in web-browser.</p>
<p>Following command can be used to get the logs from the EI front-end container/service:</p>

<div>
<div>
<pre class="source">docker-compose -f src/main/docker/docker-compose.yml logs ei_frontend
</pre></div></div>

<p>All service names can be retrieved with following command:</p>

<div>
<div>
<pre class="source">docker-compose -f src/main/docker/docker-compose.yml config --services
</pre></div></div>

<p>It is also possible to retrieve the logs by only using &#x201c;docker logs &lt;container_id or container_name&gt;&#x201d; command:</p>

<div>
<div>
<pre class="source">docker logs &lt;container_id or container_name&gt;
</pre></div></div>

<p>Container id can be retrieved with docker command:</p>

<div>
<div>
<pre class="source">docker ps
</pre></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                          
                </div>

        
                </div>
    </footer>
        </body>
</html>
